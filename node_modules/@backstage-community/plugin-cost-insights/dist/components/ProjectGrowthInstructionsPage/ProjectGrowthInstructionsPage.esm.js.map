{"version":3,"file":"ProjectGrowthInstructionsPage.esm.js","sources":["../../../src/components/ProjectGrowthInstructionsPage/ProjectGrowthInstructionsPage.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { DateTime } from 'luxon';\nimport Box from '@material-ui/core/Box';\nimport Typography from '@material-ui/core/Typography';\nimport { AlertInstructionsLayout } from '../AlertInstructionsLayout';\nimport { ProductInsightsChart } from '../ProductInsightsCard';\nimport {\n  Alert,\n  DEFAULT_DATE_FORMAT,\n  Duration,\n  ProjectGrowthData,\n} from '../../types';\nimport {\n  Entity,\n  Product,\n} from '@backstage-community/plugin-cost-insights-common';\nimport { ProjectGrowthAlert } from '../../alerts';\nimport { InfoCard } from '@backstage/core-components';\n\nconst today = DateTime.now().toFormat(DEFAULT_DATE_FORMAT);\n\nexport const ProjectGrowthInstructionsPage = () => {\n  const alertData: ProjectGrowthData = {\n    project: 'example-project',\n    periodStart: 'Q1 2020',\n    periodEnd: 'Q2 2020',\n    aggregation: [60000, 120000],\n    change: {\n      ratio: 1,\n      amount: 60000,\n    },\n    products: [\n      {\n        id: 'Compute Engine',\n        aggregation: [58000, 118000],\n      },\n      {\n        id: 'Cloud Dataflow',\n        aggregation: [1200, 1500],\n      },\n      {\n        id: 'Cloud Storage',\n        aggregation: [800, 500],\n      },\n    ],\n  };\n\n  const projectGrowthAlert: Alert = new ProjectGrowthAlert(alertData);\n\n  const product: Product = {\n    kind: 'ComputeEngine',\n    name: 'Compute Engine',\n  };\n\n  const entity: Entity = {\n    id: 'example-id',\n    aggregation: [20_000, 60_000],\n    change: {\n      ratio: 3,\n      amount: 40_000,\n    },\n    entities: {\n      service: [\n        {\n          id: 'service-one',\n          aggregation: [18_200, 58_500],\n          entities: {},\n          change: { ratio: 2.21, amount: 40_300 },\n        },\n        {\n          id: 'service-two',\n          aggregation: [1200, 1300],\n          entities: {},\n          change: { ratio: 0.083, amount: 100 },\n        },\n        {\n          id: 'service-three',\n          aggregation: [600, 200],\n          entities: {},\n          change: { ratio: -0.666, amount: -400 },\n        },\n      ],\n    },\n  };\n\n  return (\n    <AlertInstructionsLayout title=\"Investigating Growth\">\n      <Typography variant=\"h1\">Investigating cloud cost growth</Typography>\n      <Typography paragraph>\n        Cost Insights shows an alert when costs for a particular billing entity,\n        such as a GCP project, have grown at a rate faster than our alerting\n        threshold. The responsible team should follow this guide to decide\n        whether this warrants further investigation.\n      </Typography>\n\n      <Box mt={4}>\n        <Typography variant=\"h3\">Is the growth expected?</Typography>\n        <Typography paragraph>\n          The first question to ask is whether growth is expected. Perhaps a new\n          product has been deployed, or additional regions added for\n          reliability.\n        </Typography>\n        <Typography paragraph>\n          Many services increase cost linearly with load. Has the demand\n          increased? This may happen as you open new markets, or run marketing\n          offers. Costs should be compared against a business metric, such as\n          daily users, to normalize natural increases from business growth.\n        </Typography>\n        <Typography paragraph>\n          Seasonal variance may also cause cost growth; yearly campaigns, an\n          increase in demand during certain times of year.\n        </Typography>\n        <Typography paragraph>\n          Cloud costs will often go up before they go down, in the case of\n          migrations. Teams moving to new infrastructure may run in both the old\n          and new environment during the migration.\n        </Typography>\n      </Box>\n\n      <Box mt={4}>\n        <Typography variant=\"h3\">Is the growth significant?</Typography>\n        <Typography paragraph>\n          Next, evaluate whether the growth is significant. This helps avoid\n          premature optimization, where cost in engineering time is more than\n          would be saved from the optimization over a reasonable time frame.\n        </Typography>\n        <Typography paragraph>\n          We recommend reframing the cost growth itself in terms of engineering\n          time. How much engineering time, for an <i>average</i> fully-loaded\n          engineer cost at the company, is being overspent each month? Compare\n          this to expected engineering time for optimization to decide whether\n          the optimization is worthwhile.\n        </Typography>\n      </Box>\n\n      <Box mt={4}>\n        <Typography variant=\"h3\">\n          Identifying which cloud product contributed most\n        </Typography>\n        <Typography paragraph>\n          For projects meeting the alert threshold, Cost Insights shows a cost\n          comparison of cloud products over the examined time period:\n        </Typography>\n        <Box mt={2} mb={2}>\n          {projectGrowthAlert.element}\n        </Box>\n        <Typography paragraph>\n          This allows you to quickly see which cloud products contributed to the\n          growth in cloud costs.\n        </Typography>\n      </Box>\n\n      <Box mt={4}>\n        <Typography variant=\"h3\">\n          Identifying the responsible workload\n        </Typography>\n        <Typography paragraph>\n          After identifying the cloud product, use the corresponding product\n          panel in Cost Insights to find a particular workload (or <i>entity</i>\n          ) that has grown in cost:\n        </Typography>\n        <Box mt={2} mb={2}>\n          <InfoCard title={product.name} subheader=\"3 entities, sorted by cost\">\n            <ProductInsightsChart\n              billingDate={today}\n              duration={Duration.P3M}\n              entity={entity}\n            />\n          </InfoCard>\n        </Box>\n        <Typography paragraph>\n          From here, you can dig into commit history or deployment logs to find\n          probable causes of an unexpected spike in cost.\n        </Typography>\n      </Box>\n\n      <Box mt={4}>\n        <Typography variant=\"h3\">Optimizing the workload</Typography>\n        <Typography paragraph>\n          Workload optimization varies between cloud products, but there are a\n          few general optimization areas to consider:\n        </Typography>\n        <Typography variant=\"h5\">Retention</Typography>\n        <Typography paragraph>\n          Is the workload or storage necessary? Truly idle or unused resources\n          can be cleaned up for immediate cost savings. For storage, how long do\n          we need the data? Many cloud products support retention policies to\n          automatically delete data after a certain time period.\n        </Typography>\n        <Typography variant=\"h5\">Efficiency</Typography>\n        <Typography paragraph>\n          Is the workload using cloud resources efficiently? For compute\n          resources, do the utilization metrics look reasonable? Autoscaling\n          infrastructure, such as Kubernetes, can run workloads more efficiently\n          without compromising reliability.\n        </Typography>\n        <Typography variant=\"h5\">Lifecycle</Typography>\n        <Typography paragraph>\n          Is the workload using an optimal pricing model? Some cloud products\n          offer better pricing for data that is accessed less frequently.\n        </Typography>\n      </Box>\n    </AlertInstructionsLayout>\n  );\n};\n"],"names":[],"mappings":"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"}