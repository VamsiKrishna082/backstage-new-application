{"version":3,"file":"KubernetesMigrationAlert.esm.js","sources":["../../../src/example/alerts/KubernetesMigrationAlert.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport pluralize from 'pluralize';\nimport Typography from '@material-ui/core/Typography';\nimport { KubernetesMigrationAlertCard } from '../components';\nimport { CostInsightsApi } from '../../api';\nimport {\n  Alert,\n  AlertForm,\n  AlertOptions,\n  AlertStatus,\n  AlertSnoozeFormData,\n} from '../../types';\nimport {\n  ChangeStatistic,\n  Entity,\n} from '@backstage-community/plugin-cost-insights-common';\nimport {\n  KubernetesMigrationDismissForm,\n  KubernetesMigrationDismissFormData,\n} from '../forms';\nimport { Lifecycle } from '@backstage/core-components';\n\nexport interface KubernetesMigrationData {\n  startDate: string;\n  endDate: string;\n  change: ChangeStatistic;\n  services: Array<Entity>;\n}\n\nexport interface KubernetesMigrationApi extends Alert {\n  api: CostInsightsApi;\n  data: KubernetesMigrationData;\n}\n\n/**\n * This is an example of an Alert implementation using optional event hooks.\n *\n * Event hooks can be used to enable users to dismiss, snooze, or accept an action item\n * - or any combination thereof. Defining a hook will generate default UI - button, dialog and\n * form. Cost Insights does not preserve client side alert state - each hook is expected to return a new set of alerts.\n *\n * Snoozed, accepted, etc. alerts should define a corresponding status property. Alerts will be aggregated\n * by status in a collapsed view below Alert Insights section and a badge will appear in Action Items\n * showing the total alerts of that status.\n *\n * Customizing Alerts\n * Default forms can be overridden in two ways - by setting a form property to null or defining a custom component.\n *\n * If a form property is set to null, the Dialog will not render a form. This can be useful in scenarios\n * where data isn't needed from the user such as when a user accepts an action item's recommendation.\n *\n * If a form property is set to a React component, the Dialog will render the form component in place of the default form.\n * Form components must return valid form elements, and accept a ref and onSubmit event handler.\n * Custom forms must implement the corresponding event hook. See /forms for example implementations.\n */\n\nexport class KubernetesMigrationAlert implements KubernetesMigrationApi {\n  api: CostInsightsApi;\n  data: KubernetesMigrationData;\n\n  subtitle =\n    'Services running on Kubernetes are estimated to save 50% or more compared to Compute Engine.';\n\n  // Dialog will not render a form if form property set to null.\n  AcceptForm = null;\n  // Overrides default Dismiss form with a custom form component.\n  DismissForm: AlertForm<\n    KubernetesMigrationAlert,\n    KubernetesMigrationDismissFormData\n  > = KubernetesMigrationDismissForm;\n\n  constructor(api: CostInsightsApi, data: KubernetesMigrationData) {\n    this.api = api;\n    this.data = data;\n  }\n\n  get title() {\n    return (\n      <Typography component=\"span\">\n        Consider migrating{' '}\n        {pluralize('service', this.data.services.length, true)} to Kubernetes{' '}\n        <Lifecycle shorthand />\n      </Typography>\n    );\n  }\n\n  get element() {\n    const subheader = `${pluralize(\n      'Service',\n      this.data.services.length,\n      true,\n    )}, sorted by cost`;\n    return (\n      <KubernetesMigrationAlertCard\n        data={this.data}\n        title=\"Migrate to Kubernetes\"\n        subheader={subheader}\n        currentProduct=\"Compute Engine\"\n        comparedProduct=\"Kubernetes\"\n      />\n    );\n  }\n\n  /* Fires when the onSubmit event is raised on a Dismiss form. Displays custom dismiss form. */\n  async onDismissed(\n    options: AlertOptions<KubernetesMigrationDismissFormData>,\n  ): Promise<Alert[]> {\n    const alerts = await this.api.getAlerts(options.group);\n    return new Promise(resolve =>\n      setTimeout(resolve, 750, [\n        ...alerts.filter(a => a.title !== this.title),\n        {\n          title: this.title,\n          subtitle: this.subtitle,\n          status: AlertStatus.Dismissed,\n        },\n      ]),\n    );\n  }\n\n  /* Fires when the onSubmit event is raised on a Snooze form. Displays default snooze form. */\n  async onSnoozed(\n    options: AlertOptions<AlertSnoozeFormData>,\n  ): Promise<Alert[]> {\n    const alerts = await this.api.getAlerts(options.group);\n    return new Promise(resolve =>\n      setTimeout(resolve, 750, [\n        ...alerts.filter(a => a.title !== this.title),\n        {\n          title: this.title,\n          subtitle: this.subtitle,\n          status: AlertStatus.Snoozed,\n        },\n      ]),\n    );\n  }\n\n  /* Fires when the Accept button is clicked. Dialog does not render a form. See KubernetesMigrationAlert.AcceptForm */\n  async onAccepted(options: AlertOptions<null>): Promise<Alert[]> {\n    const alerts = await this.api.getAlerts(options.group);\n    return new Promise(resolve =>\n      setTimeout(resolve, 750, [\n        ...alerts.filter(a => a.title !== this.title),\n        {\n          title: this.title,\n          subtitle: this.subtitle,\n          status: AlertStatus.Accepted,\n        },\n      ]),\n    );\n  }\n}\n"],"names":[],"mappings":"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"}