{"version":3,"file":"RecentWorkflowRunsCard.esm.js","sources":["../../../src/components/Cards/RecentWorkflowRunsCard.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { useEffect } from 'react';\nimport { Link as RouterLink } from 'react-router-dom';\nimport { GITHUB_ACTIONS_ANNOTATION } from '../getProjectNameFromEntity';\nimport { useWorkflowRuns, WorkflowRun } from '../useWorkflowRuns';\nimport { WorkflowRunStatus } from '../WorkflowRunStatus';\nimport Typography from '@material-ui/core/Typography';\n\nimport { errorApiRef, useApi, useRouteRef } from '@backstage/core-plugin-api';\nimport {\n  ErrorPanel,\n  InfoCard,\n  InfoCardVariants,\n  Link,\n  Table,\n} from '@backstage/core-components';\nimport { buildRouteRef } from '../../routes';\nimport { getHostnameFromEntity } from '../getHostnameFromEntity';\nimport Box from '@material-ui/core/Box';\n\nconst firstLine = (message: string): string => message.split('\\n')[0];\n\n/** @public */\nexport const RecentWorkflowRunsCard = (props: {\n  branch?: string;\n  dense?: boolean;\n  limit?: number;\n  variant?: InfoCardVariants;\n}) => {\n  const { branch, dense = false, limit = 5, variant } = props;\n\n  const { entity } = useEntity();\n  const errorApi = useApi(errorApiRef);\n\n  const hostname = getHostnameFromEntity(entity);\n\n  const [owner, repo] = (\n    entity?.metadata.annotations?.[GITHUB_ACTIONS_ANNOTATION] ?? '/'\n  ).split('/');\n\n  const [{ runs = [], loading, error }] = useWorkflowRuns({\n    hostname,\n    owner,\n    repo,\n    branch,\n    initialPageSize: limit,\n  });\n\n  useEffect(() => {\n    if (error) {\n      errorApi.post(error);\n    }\n  }, [error, errorApi]);\n\n  const githubHost = hostname || 'github.com';\n  const routeLink = useRouteRef(buildRouteRef);\n\n  if (error) {\n    return <ErrorPanel title={error.message} error={error} />;\n  }\n\n  return (\n    <InfoCard\n      title=\"Recent Workflow Runs\"\n      subheader={branch ? `Branch: ${branch}` : 'All Branches'}\n      noPadding\n      variant={variant}\n    >\n      {!runs.length ? (\n        <div style={{ textAlign: 'center' }}>\n          <Typography variant=\"body1\">\n            This component has GitHub Actions enabled, but no workflows were\n            found.\n          </Typography>\n          <Typography variant=\"body2\">\n            <Link to={`https://${githubHost}/${owner}/${repo}/actions/new`}>\n              Create a new workflow\n            </Link>\n          </Typography>\n        </div>\n      ) : (\n        <Table<WorkflowRun>\n          isLoading={loading}\n          options={{\n            search: false,\n            paging: false,\n            padding: dense ? 'dense' : 'default',\n            toolbar: false,\n          }}\n          columns={[\n            {\n              title: 'Commit Message',\n              field: 'message',\n              render: data => (\n                <Link component={RouterLink} to={routeLink({ id: data.id! })}>\n                  {firstLine(data.message ?? '')}\n                </Link>\n              ),\n            },\n            { title: 'Branch', field: 'source.branchName' },\n            {\n              title: 'Status',\n              field: 'status',\n              render: p => (\n                <Box display=\"flex\">\n                  <WorkflowRunStatus {...p} />\n                </Box>\n              ),\n            },\n          ]}\n          data={runs}\n        />\n      )}\n    </InfoCard>\n  );\n};\n"],"names":["RouterLink"],"mappings":"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"}