{"version":3,"file":"plugin.esm.js","sources":["../src/plugin.ts"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  configApiRef,\n  createApiFactory,\n  createComponentExtension,\n  createPlugin,\n  discoveryApiRef,\n  fetchApiRef,\n} from '@backstage/core-plugin-api';\nimport {\n  UnifiedAlertingGrafanaApiClient,\n  grafanaApiRef,\n  GrafanaApiClient,\n} from './api';\n\n/**\n * The grafana plugin.\n * @public\n */\nexport const grafanaPlugin = createPlugin({\n  id: 'grafana',\n  apis: [\n    createApiFactory({\n      api: grafanaApiRef,\n      deps: {\n        discoveryApi: discoveryApiRef,\n        fetchApi: fetchApiRef,\n        configApi: configApiRef,\n      },\n      factory: ({ discoveryApi, fetchApi, configApi }) => {\n        const unifiedAlertingEnabled =\n          configApi.getOptionalBoolean('grafana.unifiedAlerting') || false;\n\n        if (!unifiedAlertingEnabled) {\n          return new GrafanaApiClient({\n            discoveryApi,\n            fetchApi,\n            domain: configApi.getString('grafana.domain'),\n            proxyPath: configApi.getOptionalString('grafana.proxyPath'),\n          });\n        }\n\n        return new UnifiedAlertingGrafanaApiClient({\n          discoveryApi,\n          fetchApi,\n          domain: configApi.getString('grafana.domain'),\n          proxyPath: configApi.getOptionalString('grafana.proxyPath'),\n        });\n      },\n    }),\n  ],\n});\n\n/**\n * Component which displays the grafana dashboards found for an entity\n * @public\n */\nexport const EntityGrafanaDashboardsCard = grafanaPlugin.provide(\n  createComponentExtension({\n    name: 'EntityGrafanaDashboardsCard',\n    component: {\n      lazy: () =>\n        import('./components/DashboardsCard').then(m => m.DashboardsCard),\n    },\n  }),\n);\n\n/**\n * Component which displays the grafana alerts found for an entity\n * @public\n */\nexport const EntityGrafanaAlertsCard = grafanaPlugin.provide(\n  createComponentExtension({\n    name: 'EntityGrafanaAlertsCard',\n    component: {\n      lazy: () => import('./components/AlertsCard').then(m => m.AlertsCard),\n    },\n  }),\n);\n\n/**\n * Component which displays the defined grafana dashboard for an entity\n * @public\n */\nexport const EntityOverviewDashboardViewer = grafanaPlugin.provide(\n  createComponentExtension({\n    name: 'EntityOverviewDashboardViewer',\n    component: {\n      lazy: () =>\n        import('./components/DashboardViewer').then(\n          m => m.EntityDashboardViewer,\n        ),\n    },\n  }),\n);\n"],"names":[],"mappings":";;;AAkCO,MAAM,gBAAgB,YAAa,CAAA;AAAA,EACxC,EAAI,EAAA,SAAA;AAAA,EACJ,IAAM,EAAA;AAAA,IACJ,gBAAiB,CAAA;AAAA,MACf,GAAK,EAAA,aAAA;AAAA,MACL,IAAM,EAAA;AAAA,QACJ,YAAc,EAAA,eAAA;AAAA,QACd,QAAU,EAAA,WAAA;AAAA,QACV,SAAW,EAAA;AAAA,OACb;AAAA,MACA,SAAS,CAAC,EAAE,YAAc,EAAA,QAAA,EAAU,WAAgB,KAAA;AAClD,QAAA,MAAM,sBACJ,GAAA,SAAA,CAAU,kBAAmB,CAAA,yBAAyB,CAAK,IAAA,KAAA;AAE7D,QAAA,IAAI,CAAC,sBAAwB,EAAA;AAC3B,UAAA,OAAO,IAAI,gBAAiB,CAAA;AAAA,YAC1B,YAAA;AAAA,YACA,QAAA;AAAA,YACA,MAAA,EAAQ,SAAU,CAAA,SAAA,CAAU,gBAAgB,CAAA;AAAA,YAC5C,SAAA,EAAW,SAAU,CAAA,iBAAA,CAAkB,mBAAmB;AAAA,WAC3D,CAAA;AAAA;AAGH,QAAA,OAAO,IAAI,+BAAgC,CAAA;AAAA,UACzC,YAAA;AAAA,UACA,QAAA;AAAA,UACA,MAAA,EAAQ,SAAU,CAAA,SAAA,CAAU,gBAAgB,CAAA;AAAA,UAC5C,SAAA,EAAW,SAAU,CAAA,iBAAA,CAAkB,mBAAmB;AAAA,SAC3D,CAAA;AAAA;AACH,KACD;AAAA;AAEL,CAAC;AAMM,MAAM,8BAA8B,aAAc,CAAA,OAAA;AAAA,EACvD,wBAAyB,CAAA;AAAA,IACvB,IAAM,EAAA,6BAAA;AAAA,IACN,SAAW,EAAA;AAAA,MACT,IAAA,EAAM,MACJ,OAAO,0CAA6B,EAAE,IAAK,CAAA,CAAA,CAAA,KAAK,EAAE,cAAc;AAAA;AACpE,GACD;AACH;AAMO,MAAM,0BAA0B,aAAc,CAAA,OAAA;AAAA,EACnD,wBAAyB,CAAA;AAAA,IACvB,IAAM,EAAA,yBAAA;AAAA,IACN,SAAW,EAAA;AAAA,MACT,IAAA,EAAM,MAAM,OAAO,sCAAyB,EAAE,IAAK,CAAA,CAAA,CAAA,KAAK,EAAE,UAAU;AAAA;AACtE,GACD;AACH;AAMO,MAAM,gCAAgC,aAAc,CAAA,OAAA;AAAA,EACzD,wBAAyB,CAAA;AAAA,IACvB,IAAM,EAAA,+BAAA;AAAA,IACN,SAAW,EAAA;AAAA,MACT,IAAM,EAAA,MACJ,OAAO,2CAA8B,CAAE,CAAA,IAAA;AAAA,QACrC,OAAK,CAAE,CAAA;AAAA;AACT;AACJ,GACD;AACH;;;;"}