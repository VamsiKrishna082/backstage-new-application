{"version":3,"file":"withLocations.cjs.js","sources":["../../src/lib/withLocations.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ANNOTATION_LOCATION,\n  ANNOTATION_ORIGIN_LOCATION,\n  Entity,\n} from '@backstage/catalog-model';\nimport { merge } from 'lodash';\nimport {\n  ANNOTATION_GITHUB_TEAM_SLUG,\n  ANNOTATION_GITHUB_USER_LOGIN,\n} from './annotation';\nimport { splitTeamSlug } from './util';\n\n// Makes sure that emitted entities have a proper location\nexport function withLocations(\n  baseUrl: string,\n  org: string,\n  entity: Entity,\n): Entity {\n  const login =\n    entity.metadata.annotations?.[ANNOTATION_GITHUB_USER_LOGIN] ||\n    entity.metadata.name;\n\n  let team = entity.metadata.name;\n  const slug = entity.metadata.annotations?.[ANNOTATION_GITHUB_TEAM_SLUG];\n  if (slug) {\n    const [_, slugTeam] = splitTeamSlug(slug);\n    team = slugTeam;\n  }\n\n  const location =\n    entity.kind === 'Group'\n      ? `url:${baseUrl}/orgs/${org}/teams/${team}`\n      : `url:${baseUrl}/${login}`;\n  return merge(\n    {\n      metadata: {\n        annotations: {\n          [ANNOTATION_LOCATION]: location,\n          [ANNOTATION_ORIGIN_LOCATION]: location,\n        },\n      },\n    },\n    entity,\n  ) as Entity;\n}\n"],"names":["ANNOTATION_GITHUB_USER_LOGIN","ANNOTATION_GITHUB_TEAM_SLUG","splitTeamSlug","merge","ANNOTATION_LOCATION","ANNOTATION_ORIGIN_LOCATION"],"mappings":";;;;;;;AA6BgB,SAAA,aAAA,CACd,OACA,EAAA,GAAA,EACA,MACQ,EAAA;AACR,EAAA,MAAM,QACJ,MAAO,CAAA,QAAA,CAAS,cAAcA,uCAA4B,CAAA,IAC1D,OAAO,QAAS,CAAA,IAAA;AAElB,EAAI,IAAA,IAAA,GAAO,OAAO,QAAS,CAAA,IAAA;AAC3B,EAAA,MAAM,IAAO,GAAA,MAAA,CAAO,QAAS,CAAA,WAAA,GAAcC,sCAA2B,CAAA;AACtE,EAAA,IAAI,IAAM,EAAA;AACR,IAAA,MAAM,CAAC,CAAA,EAAG,QAAQ,CAAA,GAAIC,mBAAc,IAAI,CAAA;AACxC,IAAO,IAAA,GAAA,QAAA;AAAA;AAGT,EAAA,MAAM,QACJ,GAAA,MAAA,CAAO,IAAS,KAAA,OAAA,GACZ,OAAO,OAAO,CAAA,MAAA,EAAS,GAAG,CAAA,OAAA,EAAU,IAAI,CAAA,CAAA,GACxC,CAAO,IAAA,EAAA,OAAO,IAAI,KAAK,CAAA,CAAA;AAC7B,EAAO,OAAAC,YAAA;AAAA,IACL;AAAA,MACE,QAAU,EAAA;AAAA,QACR,WAAa,EAAA;AAAA,UACX,CAACC,gCAAmB,GAAG,QAAA;AAAA,UACvB,CAACC,uCAA0B,GAAG;AAAA;AAChC;AACF,KACF;AAAA,IACA;AAAA,GACF;AACF;;;;"}