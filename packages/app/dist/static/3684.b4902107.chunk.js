"use strict";(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3684],{54361:(it,T,t)=>{t.d(T,{b:()=>L});var n=t(97214);const L=[[n.L8,n.vv],[n.Ey,n.fO],[n.IB,n.ZD],[n.sA,n.jn],[n.Kx,n.Qz],[n.zj,n.u0],[n.nC,n.fT]]},60332:(it,T,t)=>{t.d(T,{L:()=>ot});var n=t(31085),L=t(78560),K=t(80609),O=t(47090),H=t(18139),$=t(24453),V=t(78467),M=t(58837),Y=t(54917),Z=t(53373),j=t.n(Z),R=t(14041),X=t(22249);const J=(0,X.A)(e=>({text:{fill:e.palette.textContrast},secondary:{fill:e.palette.textSubtle}}),{name:"PluginCatalogGraphCustomLabel"});function b({edge:{relations:e}}){const o=J();return(0,n.jsx)("text",{className:o.text,textAnchor:"middle",children:e.map((r,p)=>(0,n.jsxs)("tspan",{className:j()(p%2!==0&&o.secondary),children:[p>0&&(0,n.jsx)("tspan",{children:" / "}),r]},r))})}var k=t(46509),w=t(10437);function q({icon:e,...o}){const r=e??w.A;return(0,n.jsx)(r,{...o})}var U=t(55488);const G=(0,M.A)(e=>({node:{fill:e.palette.grey[300],stroke:e.palette.grey[300],"&.primary":{fill:e.palette.primary.light,stroke:e.palette.primary.light},"&.secondary":{fill:e.palette.secondary.light,stroke:e.palette.secondary.light}},text:{fill:e.palette.getContrastText(e.palette.grey[300]),"&.primary":{fill:e.palette.primary.contrastText},"&.secondary":{fill:e.palette.secondary.contrastText},"&.focused":{fontWeight:"bold"}},clickable:{cursor:"pointer"}}),{name:"PluginCatalogGraphCustomNode"});function _({node:{id:e,entity:o,color:r="default",focused:p,onClick:i}}){const h=G(),[N,S]=(0,R.useState)(0),[v,A]=(0,R.useState)(0),c=(0,R.useRef)(null),a=(0,k.f)(o,{defaultNamespace:U.oQ});(0,R.useLayoutEffect)(()=>{if(c.current){let{height:l,width:u}=c.current.getBBox();l=Math.round(l),u=Math.round(u),(l!==v||u!==N)&&(S(u),A(l))}},[N,v]);const d=!!a.Icon,f=10,m=v,g=d?m+f:0,E=g+N+f*2,x=v+f*2,I=a.primaryTitle??e;return(0,n.jsxs)("g",{onClick:i,className:j()(i&&h.clickable),children:[(0,n.jsx)("rect",{className:j()(h.node,r==="primary"&&"primary",r==="secondary"&&"secondary"),width:E,height:x,rx:10}),d&&(0,n.jsx)(q,{icon:a.Icon,y:f,x:f,width:m,height:m,className:j()(h.text,p&&"focused",r==="primary"&&"primary",r==="secondary"&&"secondary")}),(0,n.jsx)("text",{ref:c,className:j()(h.text,p&&"focused",r==="primary"&&"primary",r==="secondary"&&"secondary"),y:x/2,x:g+(N+f*2)/2,textAnchor:"middle",alignmentBaseline:"middle",children:I}),(0,n.jsx)("title",{children:a.entityRef})]})}var z=t(54361),W=t(60241),B=t(22771),Q=t(30043),F=t(87290);function tt(){const e=(0,H.gf)(Q.v),o=(0,R.useRef)({requestedEntities:new Set,outstandingEntities:new Map,cachedEntities:new Map}),[r,p]=(0,R.useState)({}),i=(0,R.useCallback)(()=>{const{cachedEntities:c,requestedEntities:a}=o.current,d={};a.forEach(f=>{const m=c.get(f);m&&(d[f]=m)}),p(d)},[o,p]),[h,N]=(0,F.A)(async()=>{const{requestedEntities:c,cachedEntities:a}=o.current,d=Array.from(c).filter(m=>!a.has(m));if(d.length===0){i();return}const{items:f}=await e.getEntitiesByRefs({entityRefs:d});f.forEach(m=>{if(m){const g=(0,L.U2)(m);a.set(g,m)}}),i()},[o,i]),{loading:S,error:v}=h,A=(0,R.useCallback)(c=>{const a=new Set(c),{requestedEntities:d}=o.current;(a.size!==d.size||Array.from(a).some(f=>!d.has(f)))&&(o.current.requestedEntities=a,N(),i())},[o,N,i]);return{entities:r,loading:S,error:v,requestEntities:A}}var et=t(45250);function st({rootEntityRefs:e,filter:{maxDepth:o=Number.POSITIVE_INFINITY,relations:r,kinds:p,entityFilter:i}={}}){const{entities:h,loading:N,error:S,requestEntities:v}=tt();return(0,R.useEffect)(()=>{const c=new Set([...e]),a=new Set;let d=[...e],f=0;for(;d.length>0&&(!isFinite(o)||f<o);){const m=d;for(d=[];m.length>0;){const g=m.shift(),E=h[g];if(a.add(g),E&&E.relations){if(i&&!i(E))continue;for(const x of E.relations)(!r||r.includes(x.type))&&(!p||p.some(I=>x.targetRef.startsWith(`${I.toLocaleLowerCase("en-US")}:`)))&&(a.has(x.targetRef)||(d.push(x.targetRef),c.add(x.targetRef)))}}++f}v([...c])},[h,e,o,r,p,i,v]),{entities:(0,R.useMemo)(()=>i?(0,et.pickBy)(h,(c,a)=>i(c)):h,[h,i]),loading:N,error:S}}function nt({rootEntityRefs:e,maxDepth:o=Number.POSITIVE_INFINITY,unidirectional:r=!0,mergeRelations:p=!0,kinds:i,relations:h,entityFilter:N,onNodeClick:S,relationPairs:v=z.b}){const[A,c]=(0,R.useState)({}),{entities:a,loading:d,error:f}=st({rootEntityRefs:e,filter:{maxDepth:o,kinds:i,relations:h,entityFilter:N}});return(0,B.A)(()=>{if(!a||Object.keys(a).length===0){c({});return}const m=Object.entries(a).map(([l,u])=>{const s=e.includes(l),y={id:l,entity:u,focused:s,color:s?"secondary":"primary",kind:u.kind,name:u.metadata.name,namespace:u.metadata.namespace||U.oQ,title:u.metadata.title,spec:u.spec};return S&&(y.onClick=C=>S(y,C)),y}),g=[],E=new Set,x=[...e];for(;x.length>0;){const l=x.pop(),u=a[l];E.add(l),u&&u?.relations?.forEach(s=>{if(a[s.targetRef]&&!(h&&!h.includes(s.type))&&!(i&&!i.some(y=>s.targetRef.startsWith(`${y.toLocaleLowerCase("en-US")}:`)))){if(!r||!E.has(s.targetRef))if(p){const y=v.find(([P,D])=>P===s.type||D===s.type)??[s.type],[C]=y;g.push({from:C===s.type?l:s.targetRef,to:C===s.type?s.targetRef:l,relations:y,label:"visible"})}else g.push({from:l,to:s.targetRef,relations:[s.type],label:"visible"});if(E.has(s.targetRef)||(x.push(s.targetRef),E.add(s.targetRef)),r){const y=g.findIndex(C=>l===C.from&&s.targetRef===C.to&&!C.relations.includes(s.type));if(y>=0)if(p){const C=v.find(([P,D])=>P===s.type||D===s.type)??[s.type];g[y].relations=[...g[y].relations,...C]}else g[y].relations=[...g[y].relations,s.type]}}})}const I=g.reduce((l,u)=>{const s=l.findIndex(y=>y.from===u.from&&y.to===u.to);return s>=0?(l[s]={...l[s],relations:Array.from(new Set([...l[s].relations,...u.relations]))},l):[...l,u]},[]);c({nodes:m,edges:I})},100,[a,e,i,h,r,p,S,v]),{loading:d,error:f,...A}}const at=(0,M.A)(e=>({progress:{position:"absolute",left:"50%",top:"50%",marginLeft:"-20px",marginTop:"-20px"},container:{position:"relative",width:"100%",display:"flex",flexDirection:"column"},graph:{width:"100%",flex:1,"& path[marker-end]":{transition:"filter 0.1s ease-in-out"},"& path[marker-end]:hover":{filter:`drop-shadow(2px 2px 4px ${e.palette.primary.dark});`},"& g[data-testid=label]":{transition:"transform 0s"}}}),{name:"PluginCatalogGraphEntityRelationsGraph"}),ot=e=>{const{rootEntityNames:o,maxDepth:r=2,unidirectional:p=!0,mergeRelations:i=!0,kinds:h,relations:N,entityFilter:S,direction:v=W.O.LEFT_RIGHT,onNodeClick:A,relationPairs:c=z.b,className:a,zoom:d="enabled",renderNode:f,renderLabel:m,curve:g,showArrowHeads:E}=e,x=(0,Y.A)(),I=at(),l=(0,R.useMemo)(()=>(Array.isArray(o)?o:[o]).map(D=>(0,L.U2)(D)),[o]),u=(0,H.gf)($.m),{loading:s,error:y,nodes:C,edges:P}=nt({rootEntityRefs:l,maxDepth:r,unidirectional:p,mergeRelations:i,kinds:h,relations:N,entityFilter:S,onNodeClick:A,relationPairs:c});return(0,R.useEffect)(()=>{y&&u.post(y)},[u,y]),(0,n.jsxs)("div",{className:j()(I.container,a),children:[s&&(0,n.jsx)(V.A,{className:I.progress}),C&&P&&(0,n.jsx)(K.w,{nodes:C,edges:P,renderNode:f||_,renderLabel:m||b,direction:v,className:I.graph,paddingX:x.spacing(4),paddingY:x.spacing(4),labelPosition:O.D.LabelPosition.RIGHT,labelOffset:x.spacing(1),zoom:d,curve:g,showArrowHeads:E})]})}},93684:(it,T,t)=>{t.r(T),t.d(T,{CatalogGraphCard:()=>U});var n=t(31085),L=t(78560),K=t(21332),O=t(72814),H=t(52262),$=t(16400),V=t(20987),M=t(53318),Y=t(58837),Z=t(45810),j=t.n(Z),R=t(14041),X=t(18690),J=t(15496),b=t(60332),k=t(54361),w=t(60241);const q=(0,Y.A)({card:({height:G})=>({display:"flex",flexDirection:"column",maxHeight:G,minHeight:G}),graph:{flex:1,minHeight:0}},{name:"PluginCatalogGraphCatalogGraphCard"}),U=G=>{const{variant:_="gridItem",relationPairs:z=k.b,maxDepth:W=1,unidirectional:B=!0,mergeRelations:Q=!0,direction:F=w.O.LEFT_RIGHT,kinds:tt,relations:et,entityFilter:st,height:nt,className:at,action:ot,rootEntityNames:e,onNodeClick:o,title:r="Relations",zoom:p="enable-on-click"}=G,{entity:i}=(0,$.tN)(),h=(0,R.useMemo)(()=>(0,L.sM)(i),[i]),N=(0,O.S)(V.s),S=(0,O.S)(J.c),v=(0,X.Zp)(),A=q({height:nt}),c=(0,H.s)(),a=(0,R.useCallback)((m,g)=>{const E=(0,L.KU)(m.id),x=N({kind:E.kind.toLocaleLowerCase("en-US"),namespace:E.namespace.toLocaleLowerCase("en-US"),name:E.name});c.captureEvent("click",m.entity.metadata.title??(0,M.S)(E),{attributes:{to:x}}),v(x)},[N,v,c]),d=j().stringify({rootEntityRefs:[(0,L.U2)(i)],maxDepth:W,unidirectional:B,mergeRelations:Q,selectedKinds:tt,selectedRelations:et,direction:F},{arrayFormat:"brackets",addQueryPrefix:!0}),f=`${S()}${d}`;return(0,n.jsx)(K.n,{title:r,action:ot,cardClassName:A.card,variant:_,noPadding:!0,deepLink:{title:"View graph",link:f},children:(0,n.jsx)(b.L,{...G,rootEntityNames:e||h,onNodeClick:o||a,className:at||A.graph,maxDepth:W,unidirectional:B,mergeRelations:Q,direction:F,relationPairs:z,entityFilter:st,zoom:p})})}}}]);})();

//# sourceMappingURL=3684.b4902107.chunk.js.map