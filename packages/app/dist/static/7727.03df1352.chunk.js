"use strict";(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7727],{67727:(K,m,s)=>{s.r(m),s.d(m,{HeadlampComponent:()=>$});var t=s(14041),k=s(77125),w=s(88951),P=s(54917);function S(d){const a=(0,P.A)(),[i,u]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{const h=setTimeout(()=>u(!0),a.transitions.duration.short);return()=>clearTimeout(h)},[a.transitions.duration.short]),i?t.createElement(w.A,{...d,"data-testid":"progress"}):t.createElement(k.A,{display:"none"})}var v=s(18690),l=s(18139),A=s(54195),T=s(27701),H=s(70984),I=s(35625);function $(){const d=(0,l.gf)(A.U),a=(0,l.gf)(T.h),[i,u]=(0,t.useState)(!1),h=5e3,[g,C]=(0,t.useState)(!0),L=(0,l.gf)(H.Y1),M=(0,l.gf)(I.g),p=async()=>{const n=await L.getClusters(),e=[];n.forEach(o=>{e.push(`${o.authProvider}${o.oidcTokenProvider?`.${o.oidcTokenProvider}`:""}`)});const r={};for(const o of e){const x=await M.getCredentials(o);r[o]=x.token}return r};(0,t.useEffect)(()=>{(async()=>{const e=await a.health(),r=e?.status!=="ok";if(C(r),!r){const o=await p();console.log("Starting Headlamp server"),a.startServer(o)}})()},[a]);const c=d.getOptionalString("headlamp.url")||`${window.location.protocol}//${window.location.hostname}:4466`,y=(0,v.Zp)(),R=(0,v.zy)();(0,t.useEffect)(()=>{const n=async()=>{try{const e=await fetch(`${c}`);if(e.ok)u(!0);else throw new Error(`Headlamp not ready: ${e.statusText}`)}catch(e){console.error("Failed to check Headlamp readiness:",e)}};if(!i){n();const e=setInterval(n,h);return()=>clearInterval(e)}},[i,c]);const f=(0,t.useCallback)(n=>{if(n.origin!==new URL(c).origin)return;const e=n.data;e.redirectPath&&y(e.redirectPath)},[c,y]);if((0,t.useEffect)(()=>(window.addEventListener("message",f),()=>window.removeEventListener("message",f)),[f]),(0,t.useEffect)(()=>{if(!g){const n=async()=>{const r=await p();console.log("Refreshing kubeconfig"),await a.refreshKubeconfig(r)};n();const e=setInterval(n,6e4);return()=>clearInterval(e)}},[g,a]),!i)return t.createElement(S,null);const E=new URLSearchParams(R.search).toString(),U=E?`${c}?${E}`:c;return t.createElement("iframe",{src:U,title:"Headlamp",style:{width:"100%",height:"100vh",border:"none"}})}}}]);})();

//# sourceMappingURL=7727.03df1352.chunk.js.map